<div>
  <div style="margin-bottom: 5px;">
    <a routerLink="/branches/{{branchId}}/{{kind}}/flows/new">
      <p-button label="Run Flow" icon="pi pi-caret-right" [style]="{'margin-right': '5px'}"></p-button>
    </a>
    <p-button label="Refresh" icon="pi pi-refresh" (onClick)="refresh()" [style]="{'margin-right': '10px'}"></p-button>
    <!--
        <p-multiSelect [options]="stagesAvailable" [(ngModel)]="selectedStages" optionLabel="name"></p-multiSelect>
        <p-multiSelect [options]="stagesAvailable" optionLabel="name" [filter]="false" style="height: 33px;" [style]="{minWidth: '12em'}" [panelStyle]="{minWidth: '12em'}"></p-multiSelect>
    -->
    <p-dropdown [options]="stagesAvailable" optionLabel="name" (onChange)="filterStages($event)"></p-dropdown>
    <a routerLink="/branches/{{branchId}}" style="margin-left: 40px;"><i class="pi pi-cog" style="vertical-align: text-bottom;"></i> Management</a>
  </div>
  <p-menu #runMenu [popup]="true" [model]="runMenuItems"></p-menu>
  <div *ngFor="let flow of flows" class="p-grid p-align-stretch">
    <div class="p-col-1">
      <a routerLink="/flows/{{flow.id}}" style="color: unset;">
        <b style="font-size: 1.2rem;">{{flow.name}}.</b>
        <div style="font-size: 0.7rem;">
          <div *ngIf="flow.branch_name">
            {{flow.branch_name}}
          </div>
          <div>{{flow.created | localtime}}</div>
          <div>{{flow.duration}}
            <span *ngIf="flow.state == 'in-progress'">
              <i class="pi pi-spin pi-spinner" style="font-size: 16px; vertical-align: text-top;"></i>
            </span>
          </div>
        </div>
      </a>
    </div>
    <div class="p-col" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(18rem, 1fr)); gap: 6px;">
      <ng-container *ngFor="let run of flow.runs">
        <app-run-box *ngIf="filterStageName=='All' || run.name==filterStageName"
                     [run]="run" [flowId]="flow.id" (onStageRun)="onStageRun($event)">
        </app-run-box>
      </ng-container>
    </div>
  </div>

  <p-paginator [rows]="10"
               [totalRecords]="totalFlows"
               [rowsPerPageOptions]="[10,20,30,50,100]"
               [showCurrentPageReport]="true"
               (onPageChange)="paginateFlows($event)"></p-paginator>

</div>
